language: python
addons:
    chrome: stable
#    firefox: latest
matrix:
    include:
        - python: 2.7
          env:
              - TOX_ENV=unit
        - python: 3.5
          env:
              - TOX_ENV=unit
        - python: 2.7
          env:
              - TOX_ENV=images
        - python: 3.5
          env:
              - TOX_ENV=images
        - python: 2.7
          env:
              - TOX_ENV=integration
        - python: 3.6
          env:
              - TOX_ENV=integration
        - python: 2.7
          env:
              - TOX_ENV=selenium
        - python: 3.6
          env:
              - TOX_ENV=selenium
        - python: 3.6
          env:
              - TOX_ENV=selenium-appium
        - python: 3.6
          env:
              - TOX_ENV=visualgrid
        - python: 3.6
          env:
              - TOX_ENV=lint
install:
    - CHROME_VERSION=$(google-chrome --version | sed -r 's/[^0-9]+([0-9]+\.[0-9]+\.[0-9]+).*/\1/g')
    - CHROMEDRIVER_VERSION=$(curl -s https://chromedriver.storage.googleapis.com/LATEST_RELEASE_$CHROME_VERSION)
    - npm install -g webdriver-manager
    - webdriver-manager update --versions.chrome=$(CHROMEDRIVER_VERSION)
    - pip install -U tox
before_script:
    - export DISPLAY=:99.0
    - sh -e /etc/init.d/xvfb start
    - nohup webdriver-manager start --logging=ERROR &
    - sleep 10 # give webdriver some time to start
script:
    - export APPLITOOLS_BATCH_ID=`uuidgen -t`
    - echo $APPLITOOLS_BATCH_ID
    - tox -e $TOX_ENV
