language: python
services:
  - xvfb
install:
    - pip install -U tox
before_script:
    # Run GUI apps in headless mode
    - export DISPLAY=:99.0
    - sleep 10 # give webdriver some time to start
    - export APPLITOOLS_BATCH_ID=`uuidgen -t`
script:
    - echo $APPLITOOLS_BATCH_ID
    - tox -e $TOX_ENV
stages:
    - lint
    - unit-tests
    - integration-tests
    - eyes-images-tests
    - functional-tests
jobs:
    include:
        - stage: lint
          python: 3.6
          env:
              - TOX_ENV=lint

        - stage: unit-tests
          python: 2.7
          env:
              - TOX_ENV=unit
        - python: 3.6
          env:
              - TOX_ENV=unit

        - stage: integration-tests
          python: 2.7
          env:
              - TOX_ENV=integration
        - python: 3.6
          env:
              - TOX_ENV=integration

        - stage: functional-tests
          python: 3.6
          addons:
              chrome: stable
              firefox: latest
          env:
              - TOX_ENV=selenium-on-linux
        - python: 3.6
          env:
              - TOX_ENV=images
#        - python: 3.6
#          env:
#              - TOX_ENV=selenium-on-windows-remote
#        - python: 3.6
#          env:
#              - TOX_ENV=selenium-on-macos-remote
        - python: 3.6
          env:
              - TOX_ENV=selenium-appium-remote
        - python: 3.6
          addons:
              chrome: stable
          env:
              - TOX_ENV=visualgrid
